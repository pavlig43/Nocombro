package ru.pavlig43.immutable.internal.data

import kotlinx.coroutines.flow.Flow

/**
 * Репозиторий для работы с неизменяемым списком элементов.
 *
 * Предоставляет методы для удаления элементов и реактивного отслеживания изменений.
 *
 * @param I Тип элемента списка
 */
internal interface ImmutableListRepository<I> {
    /**
     * Удаляет элементы с указанными идентификаторами.
     *
     * @param ids Множество идентификаторов для удаления
     * @return Result успешности операции
     */
    suspend fun deleteByIds(ids: Set<Int>): Result<Unit>

    /**
     * Создаёт Flow для отслеживания изменений элементов.
     *
     * Для таблиц с отношениями "один-ко-многим" (например, ProductId → Declaration),
     * возвращает только элементы, связанные с указанным родительским идентификатором.
     * Для независимых таблиц передавайте 0.
     *
     * Flow автоматически отправляет новые данные при изменении списка.
     *
     * @param parentId Родительский идентификатор для фильтрации.
     *                 Используйте 0 для таблиц без родительской связи.
     * @return Flow, который emitting Result со списком элементов или ошибкой
     */
    fun observeOnItems(parentId: Int): Flow<Result<List<I>>>
}